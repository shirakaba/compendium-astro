---
import '../styles/global.css';
import { ReactLayout } from '../components/ReactLayout';
---

<html lang="en" dir="ltr">
  <head>
    <script is:inline>
      {
        const theme = resolveTheme(
          window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark'
            : 'light'
        );

        document.documentElement.setAttribute('data-theme', theme);

        const query = window.matchMedia('(prefers-color-scheme: dark)');
        query.addEventListener('change', function ({ matches: prefersDark }) {
          const theme = resolveTheme(prefersDark ? 'dark' : 'light');
          document.documentElement.setAttribute('data-theme', theme);
        });

        /**
         * @param {"light" | "dark"} userAgentPreference
         */
        function resolveTheme(userAgentPreference) {
          const localStorageTheme = localStorage?.getItem('theme') ?? '';
          if (['dark', 'light'].includes(localStorageTheme)) {
            return localStorageTheme;
          }

          return userAgentPreference;
        }
      }
    </script>
  </head>
  <body>
    <!--
    We have to specify a hydration rule for any interactive components.
    Otherwise, it'll render the HTML but none of the event handlers and hooks,
    etc.
    https://stackoverflow.com/questions/74875277/onclick-event-not-working-for-react-component-in-astro
    https://docs.astro.build/en/guides/framework-components/#hydrating-interactive-components
    -->
    <ReactLayout client:load><slot /></ReactLayout>
  </body>
</html>
